DROP TABLE EMP_BOARDS CASCADE CONSTRAINT;


CREATE TABLE EMP_BOARDS (
      ID NUMBER NOT NULL
    , TITLE VARCHAR2(100) NOT NULL
    , CONTENT VARCHAR2(2000) NOT NULL
    , EMPID NUMBER NOT NULL
    , CREATEDATE DATE DEFAULT(SYSDATE)
    , VIEW_CNT NUMBER DEFAULT(0)
    , "LIKE" NUMBER DEFAULT(0)
    , CONSTRAINT EMP_BOARDS_ID_PK PRIMARY KEY (ID)
    , CONSTRAINT EMP_BOARDS_EMP_ID_FK FOREIGN KEY(EMPID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
);

CREATE SEQUENCE EMP_BOARDS_SEQ NOCACHE; -- 캐시를 안 만듦
INSERT INTO EMP_BOARDS VALUE(EMP_BOARDS_SEQ.NEXTVAL, '텍스트 제목', '텍스트 내용', 100, SYSDATE)


CREATE TABLE EMP_BOARDS_STATISTICS (
	  ID NUMBER PRIMARY KEY
	, EMPID NUMBER
	, BID NUMBER
	, ISVIEW VARCHAR2(1) CHECK(ISVIEW IN ('Y', 'N'))
	, LATEST_DATE1 DATE  	-- 게시글을 언제 봤는지 확인
	, ISLIKE VARCHAR2(1) CHECK(ISLIKE IN ('Y', 'N')) -- LIKE를 눌렀는지 안 눌렀는지만 알아낸다.  
	, LATEST_DATE2 DATE	-- 언제 좋아요 눌렀는지 
	, CONSTRAINT EMP_BOARDS_STATISTICS_EMPID_FK FOREIGN KEY(EMPID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
	, CONSTRAINT EMP_BOARDS_STATISTICS_BID_FK FOREIGN KEY(BID) REFERENCES EMP_BOARDS(ID)
);

-- 지금은 봤는지 안 봤는지 확인만 하지만 좀더 상세하게 하기 위해서는 해당 게시물을 몇 번을 봤는지 체크
SELECT * FROM EMP_BOARDS_STATISTICS;

CREATE SEQUENCE EMP_BOARDS_STATISTICS_SEQ NOCACHE;

-- 게시물 기록 불러오기
SELECT ID
 			 , EMPID
 			 , BID
 			 , ISVIEW AS "view"
 			 , LATEST_DATE1 AS latestView
 			 , ISLIKE AS "like"
 			 , LATEST_DATE2 AS latestLike
 		  FROM EMP_BOARDS_STATISTICS
 		 WHERE EMPID = #{empId}
 		   AND BID = #{bId}
